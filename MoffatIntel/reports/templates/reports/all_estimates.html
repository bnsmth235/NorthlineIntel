{% extends "reports/base.html" %}

{% block title %}{{project.name}} Estimates{% endblock %}
{% load static %}

{% block content %}
<script src="{% static 'reports/deleteConfirm.js' %}"></script>

<h1 class="section-header">Estimates for {{project.name}}</h1>

<div class="add-new">
    <a href="#">Generate</a>
</div>

{% for division in divisions %}
<div style="display: block; clear: both; margin-bottom: 10px">
    <fieldset class="fieldset">
        <legend><h2>Division {{division.0}}: {{division.1}}</h2></legend>
        <div class="add-new" style="margin-right: 5px; margin-top: -30px; padding: 2px">
            <a href="#" style="font-size: 14px">+ Upload</a>
        </div>
        <div class="reports-list-div-small">
            <table width="98%" height="98%" align="center" cellpadding="4" border="0">
                <tr class="report-item headers">
                    <td></td>
                    <td>Subcontractor</td>
                    <td>Category</td>
                    <td>Bid Date</td>
                    <td>Bid Amount</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                {% regroup estimates by csi as estimate_groups %}
                {% for csi in estimate_groups %}
                    {% if csi is division.id %}
                        {% for estimate in csi.list %}
                            <tr>
                                <td width="6%">
                                    <a href="{% url 'reports:estimate_pdf_view' estimate.id %}">
                                        <img src="{% static 'reports/images/pdf_icon.png' %}" height="18px" width="auto"
                                            style="margin-bottom: -4px;margin-left:5px">
                                    </a>
                                </td>
                                <td>{{sub.name}}</td>
                                <td>{{sub.get_long_category}}</td>
                                <td>{{estimate.date}}</td>
                                <td>{{estimate.amount}}</td>
                                <td width="5%" style="text-align: center">
                                    <a href="{% url 'reports:edit_estimate' estimate.id%}">
                                        <img src="{% static 'reports/images/pencil.png' %}" height="18px" width="auto"
                                            style="margin-bottom: -4px; margin-right: 2px"> Edit
                                    </a>
                                </td>
                                <td width="5%" style="text-align: center">
                                    <form id="delete-form" method="post"
                                        data-delete-url="{% url 'reports:delete_estimate' estimate.id%}">
                                        {% csrf_token %}
                                        <input type="hidden" name="estimate_id" value="{{ estimate.id }}">
                                        <input type="hidden" name="username" id="username">
                                        <button class="inline-delete-button" type="button" onclick="deleteConfirmation(this)">
                                            <img src="{% static 'reports/images/trash.png' %}" height="15px" width="auto"> Delete
                                        </button>
                                    </form>
                                </td>
                                <td>
                                    <a href="#">Accept Bid</a>
                                </td>

                            </tr>
                        {% endfor %}
                    {% endif %}
                {% endfor %}
            </table>
        </div>
    </fieldset>
 </div>
{% endfor %}



{% endblock %}

